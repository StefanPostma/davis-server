<div class="page">
    <div *ngIf="iDavis.isWizard" class="step">
        Step 1 of 4
    </div>
    <div *ngIf="iDavis.isWizard" class="title">
        Create <span *ngIf="iDavis.values.user.admin">Administrator</span><span *ngIf="!iDavis.values.user.admin">User</span> Account
    </div>
    <div class="content">
        <form (ngSubmit)="doSubmit()" #form="ngForm">
            <section *ngIf="iDavis.config['user'].success === false" class="flex-container">
                <div class="flex-item full-width error">
                    {{iDavis.config['user'].error}}
                </div>
            </section>
            <section class="flex-container">
                <div class="flex-item half-width left-half">
                    <label>First Name</label>
                    <!-- isMyUser -->
                    <input type="text" name="first" 
                        placeholder="John" 
                        *ngIf="isMyUser"
                        [(ngModel)]="iDavis.values.user.name.first" 
                        (keyup)="validate()" required>
                        
                     <!-- !isMyUser -->
                    <input type="text" name="first" 
                        placeholder="John" 
                        *ngIf="!isMyUser"
                        [(ngModel)]="iDavis.values.otherUser.name.first" 
                        (keyup)="validate()" required>
                </div>
                 <div class="flex-item half-width right-half">
                    <label>Last Name</label>
                    <!-- isMyUser -->
                    <input type="text" name="last" 
                        placeholder="Smith" 
                        *ngIf="isMyUser"
                        [(ngModel)]="iDavis.values.user.name.last" 
                        (keyup)="validate()" required>
                        
                    <!-- !isMyUser -->
                    <input type="text" name="last" 
                        placeholder="Smith" 
                        *ngIf="!isMyUser"
                        [(ngModel)]="iDavis.values.otherUser.name.last" 
                        (keyup)="validate()" required>
                </div>
            </section>
            <section class="flex-container" *ngIf="iDavis.isWizard || !isMyUser">
                <div class="flex-item full-width">
                    <label>Email</label>
                    <!-- isMyUser -->
                    <input type="email" name="email" 
                        placeholder="john.smith@example.com" 
                        *ngIf="isMyUser"
                        [(ngModel)]="iDavis.values.user.email" 
                        (keyup)="validate()" required>
                        
                    <!-- !isMyUser -->
                    <input type="email" name="email" 
                        placeholder="john.smith@example.com" 
                        *ngIf="!isMyUser"
                        [(ngModel)]="iDavis.values.otherUser.email" 
                        (keyup)="validate()" required>
                </div>
            </section>
            <section class="flex-container">
                <div class="flex-item half-width left-half">
                    <label>{{ (iDavis.isWizard || isNewUser) ? '' : 'Change ' }}Password</label>
                    <div class="input-button-wrapper" [class.input-button-wrapper-focus]="isPasswordFocused">
                        <!-- isMyUser -->
                        <input *ngIf="isPasswordMasked && isMyUser" type="password" name="password" class="input-button-input" 
                            placeholder="&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;" 
                            [(ngModel)]="iDavis.values.user.password" 
                            (focus)="isPasswordFocused = true" 
                            (blur)="isPasswordFocused = false"
                            (keyup)="validate()"
                            [required]="(iDavis.isWizard) ? '' : null">
                        <input *ngIf="!isPasswordMasked && isMyUser" type="text" name="passwordText" class="input-button-input" 
                            placeholder="&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;" 
                            [(ngModel)]="iDavis.values.user.password" 
                            (focus)="isPasswordFocused = true" 
                            (blur)="isPasswordFocused = false"
                            (keyup)="validate()"
                            [required]="(iDavis.isWizard) ? '' : null">
                            
                        <!-- !isMyUser -->
                        <input *ngIf="isPasswordMasked && !isMyUser" type="password" name="password" class="input-button-input" 
                            placeholder="&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;" 
                            [(ngModel)]="iDavis.values.otherUser.password" 
                            (focus)="isPasswordFocused = true" 
                            (blur)="isPasswordFocused = false"
                            (keyup)="validate()"
                            [required]="(isNewUser) ? '' : null">
                        <input *ngIf="!isPasswordMasked && !isMyUser" type="text" name="passwordText" class="input-button-input" 
                            placeholder="&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;&bull;" 
                            [(ngModel)]="iDavis.values.otherUser.password" 
                            (focus)="isPasswordFocused = true" 
                            (blur)="isPasswordFocused = false"
                            (keyup)="validate()"
                            [required]="(isNewUser) ? '' : null">
                        <div class="input-button-button" (click)="isPasswordMasked = !isPasswordMasked">
                            <img class="input-button-img" [class.input-button-img-password-masked]="isPasswordMasked" src="/assets/img/eye.svg">
                        </div>
                    </div>
                </div>
                <div class="flex-item half-width right-half">
                    <label>Timezone</label>
                    <!-- isMyUser -->
                    <select *ngIf="isMyUser" name="timezone" 
                        [(ngModel)]="iDavis.values.user.timezone"
                        (ngModelChange)="onTimezoneChange($event); validate()"
                        [class.select-opened]="isSelectOpened" 
                        (click)="isSelectOpened = !isSelectOpened" 
                        (blur)="isSelectOpened = false;" required>
                        <option *ngFor="let tz of iDavis.timezones" [value]="tz">{{tz}}</option>
                    </select>
                    
                     <!-- !isMyUser -->
                    <select *ngIf="!isMyUser" name="timezone" 
                        [(ngModel)]="iDavis.values.otherUser.timezone" 
                        (ngModelChange)="onTimezoneChange($event); validate()"
                        [class.select-opened]="isSelectOpened" 
                        (click)="isSelectOpened = !isSelectOpened" 
                        (blur)="isSelectOpened = false;" required>
                        <option *ngFor="let tz of iDavis.timezones" [value]="tz">{{tz}}</option>
                    </select>
                </div>
            </section>
            <section *ngIf="!iDavis.isWizard" class="flex-container">
                <div class="flex-item full-width">
                    <label>Administrator</label>
                    <!-- isMyUser -->
                    <input type="checkbox" name="admin" 
                        [(ngModel)]="iDavis.values.user.admin"
                        [disabled]="true"
                        *ngIf="isMyUser"
                        (keyup)="validate()">
                        
                    <!-- !isMyUser -->
                    <input type="checkbox" name="admin" 
                        [(ngModel)]="iDavis.values.otherUser.admin"
                        *ngIf="!isMyUser"
                        (keyup)="validate()">
                </div>
            </section>
            <section *ngIf="!iDavis.isWizard" class="flex-container">
                <div class="flex-item full-width">
                    <label>Alexa User ID</label>
                    <!-- isMyUser -->
                    <input type="text" name="alexa" placeholder="amzn1.ask.account.AFP3ZWPOS2BGJR7OWZPO1SFXEQ..." 
                        *ngIf="isMyUser"
                        [(ngModel)]="iDavis.values.user.alexa_ids"
                        (keyup)="validate()">
                        
                    <!-- !isMyUser -->
                    <input type="text" name="alexa" placeholder="amzn1.ask.account.AFP3ZWPOS2BGJR7OWZPO1SFXEQ..." 
                        *ngIf="!isMyUser"
                        [(ngModel)]="iDavis.values.otherUser.alexa_ids"
                        (keyup)="validate()">
                </div>
            </section>
            <section class="flex-container">
                <div class="flex-item next">
                    <a href="https://github.com/Dynatrace/davis-server/blob/master/docs/getting_started.md" target="_blank" class="docs-link">{{ iDavis.helpLinkText }}</a>
                    <button type="submit" class="content-save-button" 
                        [attr.disabled]="(!form.valid || submitButton === 'Saving...' || !isDirty) ? true : null">
                        {{ submitButton }}
                    </button>
                </div>
            </section>
        </form>
    </div>
</div>